{% extends "base.html" %} {% block title %}Editar Perfil{% endblock %} {% block
content %}
<div class="max-w-4xl mx-auto px-6 py-8">
  <!-- Header -->
  <div class="mb-8">
    <div class="flex items-center justify-between">
      <div>
        <h1 class="text-3xl font-bold text-gray-900">Editar Perfil</h1>
        <p class="text-gray-600 mt-2">
          Actualiza tu información personal y configuración de cuenta.
        </p>
      </div>
      <a
        href="{{ url_for('main.profile') }}"
        class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
      >
        <i class="fas fa-arrow-left mr-2"></i>
        Volver al Perfil
      </a>
    </div>
  </div>

  <!-- Mensajes Flash -->
  {% with messages = get_flashed_messages(with_categories=true) %} {% if
  messages %} {% for category, message in messages %}
  <div
    class="mb-6 px-4 py-3 rounded-lg {% if category == 'error' %}bg-red-100 border border-red-400 text-red-700{% else %}bg-green-100 border border-green-400 text-green-700{% endif %}"
  >
    <div class="flex items-center">
      <i
        class="fas fa-{% if category == 'error' %}exclamation-circle{% else %}check-circle{% endif %} mr-2"
      ></i>
      {{ message }}
    </div>
  </div>
  {% endfor %} {% endif %} {% endwith %}

  <form method="POST" class="space-y-8">
    {{ form.hidden_tag() }}

    <!-- Información Personal -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="p-6 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">
          Información Personal
        </h2>
        <p class="text-sm text-gray-600 mt-1">
          Esta información será visible en tu perfil.
        </p>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Nombre -->
          <div>
            {{ form.nombre.label(class="block text-sm font-medium text-gray-700
            mb-2") }} {{ form.nombre(class="w-full px-3 py-2 border
            border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.nombre.errors %} {% for error in form.nombre.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Apellido -->
          <div>
            {{ form.apellido.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.apellido(class="w-full px-3 py-2
            border border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.apellido.errors %} {% for error in form.apellido.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Email -->
          <div>
            {{ form.email.label(class="block text-sm font-medium text-gray-700
            mb-2") }} {{ form.email(class="w-full px-3 py-2 border
            border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.email.errors %} {% for error in form.email.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Teléfono -->
          <div>
            {{ form.telefono.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.telefono(class="w-full px-3 py-2
            border border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.telefono.errors %} {% for error in form.telefono.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Fecha de Nacimiento -->
          <div class="md:col-span-2">
            {{ form.fecha_nacimiento.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.fecha_nacimiento(class="px-3 py-2
            border border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.fecha_nacimiento.errors %} {% for error in
            form.fecha_nacimiento.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Información de Contacto -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="p-6 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">
          Información de Contacto
        </h2>
        <p class="text-sm text-gray-600 mt-1">
          Información opcional para completar tu perfil.
        </p>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Ciudad -->
          <div>
            {{ form.ciudad.label(class="block text-sm font-medium text-gray-700
            mb-2") }} {{ form.ciudad(class="w-full px-3 py-2 border
            border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.ciudad.errors %} {% for error in form.ciudad.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Estado -->
          <div>
            {{ form.estado.label(class="block text-sm font-medium text-gray-700
            mb-2") }} {{ form.estado(class="w-full px-3 py-2 border
            border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.estado.errors %} {% for error in form.estado.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Dirección -->
          <div class="md:col-span-2">
            {{ form.direccion.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.direccion(class="w-full px-3 py-2
            border border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.direccion.errors %} {% for error in form.direccion.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Código Postal -->
          <div>
            {{ form.codigo_postal.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.codigo_postal(class="w-full px-3
            py-2 border border-gray-300 rounded-lg focus:outline-none
            focus:ring-2 focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.codigo_postal.errors %} {% for error in
            form.codigo_postal.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Cambiar Contraseña -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="p-6 border-b border-gray-200">
        <h2 class="text-lg font-semibold text-gray-900">Cambiar Contraseña</h2>
        <p class="text-sm text-gray-600 mt-1">
          Deja en blanco si no quieres cambiar tu contraseña.
        </p>
      </div>
      <div class="p-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <!-- Contraseña Actual -->
          <div>
            {{ form.old_password.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.old_password(class="w-full px-3 py-2
            border border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.old_password.errors %} {% for error in form.old_password.errors
            %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Nueva Contraseña -->
          <div>
            {{ form.new_password.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.new_password(class="w-full px-3 py-2
            border border-gray-300 rounded-lg focus:outline-none focus:ring-2
            focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.new_password.errors %} {% for error in form.new_password.errors
            %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>

          <!-- Confirmar Contraseña -->
          <div class="md:col-span-2">
            {{ form.confirm_password.label(class="block text-sm font-medium
            text-gray-700 mb-2") }} {{ form.confirm_password(class="w-full px-3
            py-2 border border-gray-300 rounded-lg focus:outline-none
            focus:ring-2 focus:ring-blue-500 focus:border-blue-500") }} {% if
            form.confirm_password.errors %} {% for error in
            form.confirm_password.errors %}
            <p class="mt-1 text-sm text-red-600">{{ error }}</p>
            {% endfor %} {% endif %}
          </div>
        </div>

        <!-- Indicador de Seguridad de Contraseña -->
        <div class="mt-4 p-4 bg-blue-50 border border-blue-200 rounded-lg">
          <div class="flex items-start space-x-3">
            <i class="fas fa-shield-alt text-blue-600 mt-1"></i>
            <div>
              <h4 class="text-sm font-medium text-blue-900">
                Recomendaciones de Seguridad
              </h4>
              <ul class="text-xs text-blue-800 mt-2 space-y-1">
                <li>• Usa al menos 8 caracteres</li>
                <li>• Incluye mayúsculas, minúsculas y números</li>
                <li>• Evita información personal fácil de adivinar</li>
                <li>• Usa una contraseña única para esta cuenta</li>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Botones de Acción -->
    <div class="flex items-center justify-between">
      <a
        href="{{ url_for('main.profile') }}"
        class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
      >
        <i class="fas fa-times mr-2"></i>
        Cancelar
      </a>

      <div class="flex items-center space-x-3">
        <button
          type="button"
          onclick="resetForm()"
          class="inline-flex items-center px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
        >
          <i class="fas fa-undo mr-2"></i>
          Restablecer
        </button>

        {{ form.submit(class="inline-flex items-center px-6 py-2 bg-blue-600
        text-white rounded-lg hover:bg-blue-700 transition-colors
        cursor-pointer") }}
      </div>
    </div>
  </form>
</div>

<script>
  // Función para restablecer el formulario
  function resetForm() {
    if (
      confirm("¿Estás seguro de que quieres restablecer todos los cambios?")
    ) {
      document.querySelector("form").reset();
      location.reload();
    }
  }

  // Validación en tiempo real de contraseña
  document.addEventListener("DOMContentLoaded", function () {
    const newPassword = document.getElementById("new_password");
    const confirmPassword = document.getElementById("confirm_password");

    if (newPassword && confirmPassword) {
      confirmPassword.addEventListener("input", function () {
        if (newPassword.value && confirmPassword.value) {
          if (newPassword.value !== confirmPassword.value) {
            confirmPassword.setCustomValidity("Las contraseñas no coinciden");
            confirmPassword.classList.add("border-red-500");
            confirmPassword.classList.remove("border-gray-300");
          } else {
            confirmPassword.setCustomValidity("");
            confirmPassword.classList.remove("border-red-500");
            confirmPassword.classList.add("border-gray-300");
          }
        }
      });
    }
  });

  // Indicador de fuerza de contraseña
  function checkPasswordStrength(password) {
    let strength = 0;

    if (password.length >= 8) strength++;
    if (/[a-z]/.test(password)) strength++;
    if (/[A-Z]/.test(password)) strength++;
    if (/[0-9]/.test(password)) strength++;
    if (/[^A-Za-z0-9]/.test(password)) strength++;

    return strength;
  }
</script>
{% endblock %}
